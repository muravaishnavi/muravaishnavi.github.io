<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="css/style.css">
    <style>
    /* .song-index {
      display: block
    } */
    .song-grid {
      width: 200px;
      box-shadow: 0 0 0 rgba(0, 0, 0, 0.3);
      display: inline-block;
      vertical-align: top;
      margin: 15px 15px 15px 15px;
    }

    .song-grid-items {
      width: 200px;
      background-color: rgb(162, 168, 181);
      color: white;
      padding: 3px 10px 3px 10px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: bold;
      
    }
    .song-grid-items:hover {
      cursor: pointer;
      background-color: rgb(128, 128, 128);
      }

      .song-preview-item {
        width: 100px;
      }
    </style>
  </head>
  <body>
    <div class="body">
      <div class="header">
        <a href="index.html" class="btn-style">Home</a>
        <a href="compose.html" class="btn-style">Compose</a>
        <input id="search" class="song-search" placeholder="Search" onkeyup="search_result()">
      </div>
        <div id="container" class="container">
        </div>
    </div>
  </body>
</html>

<script type="text/javascript">
  // let data = {}
  window.onload = function () {
     // Call the function with the desired path
    // iterateSongs('/data/');
    loadData("data/index.json", processData)
  }

  const processData = (response) => {
      localStorage.setItem("song", response);
      const jsonData = JSON.parse(response);
      // search_result(jsonData)
      renderElem(jsonData)
    };

  

   const loadData = (fileName, callback) => {
      const xObj = new XMLHttpRequest();
      xObj.overrideMimeType("application/json");
      xObj.open('GET', fileName, true);
      xObj.onreadystatechange = () => {
        if (xObj.readyState === 4 && xObj.status === 200) {
          callback(xObj.responseText);
        }
      };
      xObj.send(null);
    }


    const renderElem = (songIndex) => {
      const dataElem = document.querySelector("#container")

      // Remove all child elements, if any
      while (dataElem.firstChild) dataElem.removeChild(dataElem.firstChild)

      

      songIndex.forEach((song, index) => {
        const grid = document.createElement("div");
        grid.className = "song-grid";
        grid.append(renderBox(song));
        dataElem.append(grid);
      });
      
    }

    const renderBox = (song) => {
      const box = document.createElement("div");
      box.className = "song-grid-items";
      box.append(renderItem(song.title));
      box.append(renderItem(song.genre));
      box.append(renderItem(song.composer));
      box.append(renderItem(song.album));
      box.onclick = function() {
        window.location.href = `view.html?id=${song.id}`;
      };
      return box;
    }

    const renderItem = (item) => {
      const itemElem = document.createElement("p");
      itemElem.innerText = item;
      return itemElem;
    }

  function search_result(data){

    const input = document.getElementById("search").value.toLowerCase()
    const elemParent = document.querySelector("#container")
    
    // Remove all children from Swaram Table, if any
    while (elemParent.firstChild) elemParent.removeChild(elemParent.firstChild)

    for(i=0; i<data.length; i++){
      let obj = data[i];

      if(obj.tag && obj.tag.findIndex((txt => txt.includes(input))) > -1 ){
        const elemChild = document.createElement("div");
        elemChild.className = "flexbox";
        elemChild.innerHTML = `
        <div class = "flexbox-items">
          <a href="view.html?id=${obj.id}">${obj.title}</a>
          <div>${obj.genre}</div>
          <div>${obj.composer}</div>
          <div>${obj.album}</div>
        </div> 
        `
        elemParent.append(elemChild)
      }
    }

  }
</script>